syntax = "proto3";

option go_package = "github.com/fanyang89/easyvirt/proto";

message Void {}


message FindDomain {
  uint32 id = 1;
  string name = 2;
  string uuid = 3;
}


enum VMState {
  VM_STATE_UNDEFINED = 0;
  VM_STATE_NOSTATE = 1;
  VM_STATE_RUNNING = 2;
  VM_STATE_BLOCKED = 3;
  VM_STATE_PAUSED = 4;
  VM_STATE_SHUTDOWN = 5;
  VM_STATE_SHUTOFF = 6;
  VM_STATE_CRASHED = 7;
  VM_STATE_PMSUSPENDED = 8;
}

message VMConfig {
  string name = 1;
  string uuid = 2;
  int32 memory_mb = 3;
  int32 vcpu_count = 4;
  repeated string disks = 5;
  repeated string networks = 6;
  string os_type = 7;
  string arch = 8;
  string machine_type = 9;
}

message VirtualMachine {
  uint32 id = 1;
  string name = 2;
  string uuid = 3;
  VMState state = 4;
  int32 memory_mb = 5;
  int32 vcpu_count = 6;
  int64 cpu_time_ns = 7;
  int64 max_memory_kb = 8;
  int64 used_memory_kb = 9;
  repeated string networks = 10;
  repeated string disks = 11;
  string xml_config = 12;
  int64 created_at = 13;
  int64 updated_at = 14;
}

message CreateVMRequest {
  VMConfig config = 1;
  string xml_template = 2;
}

message CreateVMResponse {
  bool success = 1;
  string message = 2;
  VirtualMachine vm = 3;
}

message GetVMRequest {
  FindDomain domain = 1;
}

message GetVMResponse {
  bool success = 1;
  string message = 2;
  VirtualMachine vm = 3;
}

message ListVMsRequest {
  bool active = 1;
  bool inactive = 2;
  bool all = 3;
}

message ListVMsResponse {
  repeated VirtualMachine vms = 3;
}

message StartVMRequest {
  FindDomain domain = 1;
}

message StopVMRequest {
  FindDomain domain = 1;
  bool force = 2;// destory domain or not
}

message RestartVMRequest {
  FindDomain domain = 1;
  bool force = 2;
}

message PauseVMRequest {
  FindDomain domain = 1;
}

message ResumeVMRequest {
  FindDomain domain = 1;
}

message DeleteVMRequest {
  FindDomain domain = 1;
  bool delete_disks = 2;
}

message UpdateVMRequest {
  FindDomain domain = 1;
}

service EasyVirt {
  // domain CRUD
  rpc CreateVM(CreateVMRequest) returns (Void) {}
  rpc DeleteVM(DeleteVMRequest) returns (Void) {}
  rpc UpdateVM(UpdateVMRequest) returns (Void) {}
  rpc GetVM(GetVMRequest) returns (GetVMResponse) {}
  rpc ListVMs(ListVMsRequest) returns (ListVMsResponse) {}

  // operations
  rpc StartVM(StartVMRequest) returns (Void) {}
  rpc StopVM(StopVMRequest) returns (Void) {}
  rpc RestartVM(RestartVMRequest) returns (Void) {}
  rpc SuspendVM(PauseVMRequest) returns (Void) {}
  rpc ResumeVM(ResumeVMRequest) returns (Void) {}
}
