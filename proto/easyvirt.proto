syntax = "proto3";

option go_package = "github.com/fanyang89/easyvirt/proto";

message Void {}

message DomainID {
  uint32 id = 1;
  string name = 2;
  string uuid = 3;
}

message DiskDescriptor {
  string type = 1;
  string path = 2;
}

message NicDescriptor {}

message CdromDescriptor {}

message VncDescriptor {}

message VideoCardDescriptor {}

message Device {
  oneof descriptor {
    DiskDescriptor disk = 10;
    NicDescriptor nic = 11;
    CdromDescriptor cdrom = 13;
    VncDescriptor vnc = 14;
    VideoCardDescriptor video_card = 15;
  }
}

message VM {
  DomainID domain_id = 1;
  uint32 vcpu_count = 2;
  uint32 memory = 3;

  repeated string boot_devices = 10;
  repeated Device devices = 11;
}

message CreateVMRequest {
  VM vm = 1;
}

message GetVMRequest {
  DomainID domain = 1;
}

message GetVMResponse {
  VM vm = 1;
}

message ListVMsRequest {
  bool active = 1;
  bool inactive = 2;
  bool all = 3;
}

message ListVMsResponse {
  repeated VM vms = 1;
}

message StartVMRequest {
  DomainID domain = 1;
}

message StopVMRequest {
  DomainID domain = 1;
  bool force = 2;// destory domain or not
}

message RestartVMRequest {
  DomainID domain = 1;
  bool force = 2;
}

message PauseVMRequest {
  DomainID domain = 1;
}

message ResumeVMRequest {
  DomainID domain = 1;
}

message DeleteVMRequest {
  DomainID domain = 1;
  bool delete_disks = 2;
}

message UpdateVMRequest {
  DomainID domain = 1;
}

service EasyVirt {
  // domain CRUD
  rpc CreateVM(CreateVMRequest) returns (Void) {}
  rpc DeleteVM(DeleteVMRequest) returns (Void) {}
  rpc UpdateVM(UpdateVMRequest) returns (Void) {}
  rpc GetVM(GetVMRequest) returns (GetVMResponse) {}
  rpc ListVMs(ListVMsRequest) returns (ListVMsResponse) {}

  // operations
  rpc StartVM(StartVMRequest) returns (Void) {}
  rpc StopVM(StopVMRequest) returns (Void) {}
  rpc RestartVM(RestartVMRequest) returns (Void) {}
  rpc SuspendVM(PauseVMRequest) returns (Void) {}
  rpc ResumeVM(ResumeVMRequest) returns (Void) {}
}
